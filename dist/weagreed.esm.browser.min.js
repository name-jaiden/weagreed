/**
 * weagreed v0.0.3
 * (c) 2019 Jaiden
 * @license MIT
 */
const e=require("path"),r=require("fs"),n=r=>{const n=e.resolve(__dirname,"./../../../");return e.resolve(n,r)},o=function(e){return r.statSync(e).isDirectory()},t=function(e){return r.existsSync(e)};function c(e,r){e.forEach(e=>{const o=n(`${r}/${e}`);if(!t(o))throw console.error(`lack of a necessary folder ${e}`),new Error})}const i=require("path"),s=require("fs");function l(e,r,n,t){const c=[];return n=n||"",e.forEach(e=>{const l=i.join(r,e),a=o(l),p="controller"===e.toLocaleLowerCase();if(a&&!p)c.push({path:`${n}${e}`});else if(p&&t){const e=i.join(r,"controller","index.js"),n=function e(r,n,t){return s.readdirSync(r).forEach(c=>{const s=`${t}/${c}`,l=i.join(r,c);o(l)?e(l,n,s):/\.vue$/.test(c)&&n.push({[c.split(".")[0]]:`export ${c.split(".")[0]} from '${s}'`})}),n}(l,[],"."),t=n.map(e=>Object.values(e)),c=n.map(e=>Object.keys(e));s.writeFileSync(e,t.join("\n"));const a=s.readFileSync(i.join(r,"index.vue"),"utf8"),p=/<script>\nimport {.*} from '\.\/controller'/;let u;u=p.test(a)?a.replace(p,()=>`<script>\nimport {${c.join(", ")}} from './controller'`):a.replace("<script>",()=>`<script>\nimport {${c.join(", ")}} from './controller'`),s.writeFileSync(i.join(r,"index.vue"),u)}}),c}function a(e,r,n,o){n=n.replace(/(\.)\/(\/.*)/,(e,r,n)=>r+n);const c=s.readdirSync(e),p=c.includes("index.vue");if(p){const o=i.join(e,"routeConfig.json");if(t(o)){const e=function(e){const r=s.readFileSync(e,"utf8");return JSON.parse(r)}(o);r=Object.assign(r,e)}r.component=`() => import('${n}/index.vue')`}const u=l(c,e,o,p);if(u.length)return r.children=u,r.children.forEach(r=>{a(i.join(e,r.path),r,`${n}/${r.path}`)}),Object.values(r.children)}function p(e){const r=n(e),o=i.join(r,"index.js"),t=a(r,{},".","/"),c=(l=(l=t)||{},JSON.stringify(l).replace(/("component":)"(.*?)"/g,(e,r,n)=>`${r}${n}`).replace(/\"/g,"'").replace(/\[\{/g,"[\n{").replace(/}]/g,"}\n]").replace(/,/g,",\n"));var l;s.writeFileSync(o,`export default ${c}`)}c(["Api","Components","controllers","Pages","Servers","Ui"],"src"),p("src/Pages");export default{checkMustFolderList:c,generateRouter:p,version:"0.0.3"};export{c as checkMustFolderList,p as generateRouter};